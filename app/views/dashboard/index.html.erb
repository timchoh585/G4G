<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard</title>
  </head>

  <body>

    <div data-role="page" id="dashboard">

      <div data-role="header">
        <h1>Dashboard</h1>
      </div><!-- /header -->
      
      <div data-role="content">
        <ul data-role="listview" data-inset="true" id="charities" data-filter="true" data-filter-placeholder="Search Charities"></ul>
      </div><!-- /content -->

      <!-- footer navigator -->
      <div data-role="footer" data-id="foo1" data-position="fixed">
        <div data-role="navbar">
          <ul>
            <li><a href="login/login">Login</a></li>
            <li><a href="b.html">Friends</a></li>
            <li><a href="c.html">Albums</a></li>
            <li><a href="d.html">Emails</a></li>
          </ul>
        </div><!-- /navbar -->
      </div><!-- /footer -->

      <script>
    
        var numberOfHits = null;
        var charityNames = [];
        var eventsJson = null;
        function query(q){
          $.ajax({
            type: "post",
            method: "get",
            url: "https://api.justgiving.com/ab813ab8/v1/charity/search?pageSize=10&q="+q,
            headers: {'accept' : 'application/json'},
            success: function(data){
              eventsJson = data;
              numberOfHits = eventsJson.charitySearchResults.length;
              refresh();
            }
          });
        }

        query();

          function refresh(){
            for (var i = 0; i < numberOfHits; i++){
              charityNames.push(eventsJson.charitySearchResults[i].name);
            }

            charityNames.sort();

            var output = '';
            $.each(charityNames, function(index, value){
              output += '<li>' + charityNames[index] + '</li>';
            });
            
            $('#charities').html(output).listview('refresh');


          }

        $('#charities').on("filterablebeforefilter", function(e, data) {
              
              query(data.input[0].value);

            });

        </script>

    </div><!-- /page -->
  </body>
</html>